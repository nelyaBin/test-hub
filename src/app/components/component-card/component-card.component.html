<div class="component-card-wrapper">
  <div
    class="component-card"
    [class.selected]="allTestsSelected()"
    (click)="toggleSelection()"
  >
    <!-- חץ בצד שמאל -->
    <button
      *ngIf="!isPreset && data.tests.length"
      class="expand-btn"
      (click)="toggleExpand($event)"
    >
      <img
        src="assets/icons/expand-arrow.svg"
        alt="expand"
        class="expand-icon"
        [class.open]="data.isExpanded"
      />
    </button>

    <!-- Checkbox ראשי -->
    <label class="custom-checkbox">
      <input
        type="checkbox"
        [checked]="allTestsSelected()"
        [indeterminate]="partialSelected()"
        (click)="$event.stopPropagation()"
        (change)="toggleSelection()"
      />
      <span class="checkmark"></span>
    </label>

    <!-- כותרת -->
    <span class="title">{{ data.componentName }}</span>

    <!-- Partial indicator -->
    <span *ngIf="partialSelected()" class="partial-indicator"></span>

    <!-- Info button -->
    <span *ngIf="data.infoText" class="info-btn-wrapper">
      <button class="info-btn" (click)="$event.stopPropagation()">
        <span class="icon">i</span>
      </button>
      <span class="tooltip-text">{{ data.infoText }}</span>
    </span>
  </div>

  <!-- רשימת טסטים -->
  <div *ngIf="!isPreset && data.isExpanded" class="expandable">
    <div *ngFor="let test of data.tests; let i = index" class="test-item">
      <input 
        type="checkbox" 
        [checked]="!!test.selected" 
        (change)="toggleTestSelection(i, $event)"
      />
      <span class="test-name">
        <a *ngIf="test.link" [href]="test.link" target="_blank">{{
          test.testName
        }}</a>
        <span *ngIf="!test.link">{{ test.testName }}</span>
      </span>
      <span class="test-owner">({{ test.testOwner }})</span>
      <span class="test-tag">[{{ test.testTag }}]</span>
    </div>
  </div>
</div>