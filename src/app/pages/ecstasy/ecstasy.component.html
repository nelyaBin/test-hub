<!-- src/app/pages/ecstasy/ecstasy.component.html -->
<div class="load-test-container">
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title">Load Test Runner</h1>
    <p class="page-subtitle">Run and configure load tests using k6</p>
  </div>

  <!-- Configuration Section -->
  <div class="config-section">
    <!-- Form Section -->
    <app-load-test-form
      (componentChanged)="onComponentChanged($event)"
      (urlChanged)="onUrlChanged($event)"
    ></app-load-test-form>

    <!-- Graph Section -->
    <div class="config-card">
      <div class="section-header-with-toggle">
        <h3 class="section-title">
          <span class="section-icon">ğŸ“ˆ</span>
          Load Profile
        </h3>

        <div class="toggle-buttons-group">
          <button
            class="k6-phases-toggle"
            type="button"
            (click)="toggleK6Phases()"
            [class.active]="showK6Phases()"
          >
            <span class="toggle-icon">
              {{ showK6Phases() ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
            </span>
            <span>{{ showK6Phases() ? 'Hide' : 'Show' }} k6 Phases</span>
          </button>

          <button
            class="edit-mode-toggle"
            type="button"
            (click)="toggleEditMode()"
            [class.active]="isCustomMode()"
          >
            <span class="toggle-icon">âœï¸</span>
            <span>{{ isCustomMode() ? 'Lock' : 'Edit' }} Curve</span>
          </button>
        </div>
      </div>

      <!-- Graph -->
      <app-load-graph
        [controlPoints]="controlPoints()"
        [maxVUs]="maxVUs()"
        [totalDuration]="totalDurationInMinutes()"
        [isEditMode]="isCustomMode()"
        [showK6Phases]="showK6Phases()"
        [durationUnit]="durationUnit()"
        (pointAdded)="onPointAdded($event)"
        (pointUpdated)="onPointUpdated($event)"
        (pointDeleted)="onPointDeleted($event)"
      ></app-load-graph>

      <!-- Load Parameters (THE ONLY SOURCE OF testType) -->
      <app-load-parameters
        [testType]="testType()"
        (testTypeChanged)="onTestTypeChanged($event)"
        (virtualUsersChanged)="onVirtualUsersChanged($event)"
        (durationChanged)="onDurationChanged($event)"
        (durationUnitChanged)="onDurationUnitChanged($event)"
        (scenarioTypeChanged)="onScenarioTypeChanged($event)"
        (rampUpChanged)="onRampUpChanged($event)"
        (rampDownChanged)="onRampDownChanged($event)"
      ></app-load-parameters>
    </div>

    <!-- Advanced Options -->
    <app-advanced-options
      (headersChanged)="onHeadersChanged($event)"
      (thresholdsChanged)="onThresholdsChanged($event)"
      (envVarsChanged)="onEnvVarsChanged($event)"
    ></app-advanced-options>
  </div>

  <!-- Run Controls -->
  <div class="run-controls">
    <button
      class="run-button"
      type="button"
      [disabled]="!canRunTest()"
      (click)="runTest()"
    >
      <span class="run-icon">ğŸš€</span>
      <span>Run Load Test</span>
    </button>
  </div>
</div>
